{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {
      "url": "processed_genre_data.csv"
    },
    "width": 650,
    
    "transform": [{
        "calculate": "datum.genre === '' ? 'Others' : datum.genre",
        "as": "AdjustedGenre"
    },
    {
        "aggregate": [{
          "op": "count",
          "as": "GenreCount"
        }],
        "groupby": ["AdjustedGenre"]
      },
        {
        "joinaggregate": [{
            "op": "sum",
            "field": "GenreCount",
            "as": "TotalAnimes"
        }]
    },
    {
        "calculate": "datum.GenreCount / datum.TotalAnimes * 100",
        "as": "Percentage"
    }

    ],
    "layer":[
    {
    "mark": "bar",
    "height": {"step": 13},
    "encoding": {
      "y": {
        "field": "AdjustedGenre", 
        "type": "nominal", 
        "title": "Anime Genre",
        "sort": {
            "field": "Percentage",
            "order":"descending"
          }
      },
      "x": {
        "field": "Percentage",
        "type": "quantitative",
        "title": "Percentage of Total Animes (%)"
      },
      "color":{
        "condition": {
            "test": "datum.AdjustedGenre === 'Comedy'",
            "value": "#ff7f0e" 
          }
    },
      "tooltip":[
        {"field":"AdjustedGenre", "type": "nominal", "title": "Genre"},
        {"field": "GenreCount", "type": "quantitative", "title":"Number of Animes"},
        {"field": "Percentage", "type": "quantitative", "format":".2f", "title":"Percentage of Animes (%)"}
      ]

    }
    },
    {
        "mark": {
          "type": "text",
          "align":"center",
          "baseline":"middle",
          "fontSize": 12,
          "dy": -60,
          "dx":-200,
          "fontStyle": "italic"
        },
        "encoding": {
          "text": {
            "value": "The Comedy genre dominates with the highest percentage of all existing anime,"
          },
          "color": {
            "value": "black"
          },
          "x": {
            "field": "Percentage",
            "type": "quantitative",
            "aggregate": "max"
          }
          
        },
        "transform": [
          {
            "filter": {
              "field": "AdjustedGenre",
              "oneOf": ["Comedy"] 
            }
          }
        ]
      },
      {
        "mark": {
          "type": "text",
          "align":"center",
          "baseline":"middle",
          "fontSize": 12,
          "dy": -40,
          "dx":-200,
          "fontStyle": "italic"
        },
        "encoding": {
          "text": {
            "value": "showcasing its widespread popularity across the medium."
          },
          "color": {
            "value": "black"
          },
          "x": {
            "field": "Percentage",
            "type": "quantitative",
            "aggregate": "max"
          }
          
        },
        "transform": [
          {
            "filter": {
              "field": "AdjustedGenre",
              "oneOf": ["Comedy"] 
            }
          }
        ]
      }
    ]

}