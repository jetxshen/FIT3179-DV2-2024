{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {
      "url": "processed_genre_data.csv"
    },
    "width": 650,
    "mark": "bar",
    "transform": [{
        "calculate": "datum.genre === '' ? 'Others' : datum.genre",
        "as": "AdjustedGenre"
    },
    {
        "aggregate": [{
          "op": "count",
          "as": "GenreCount"
        }],
        "groupby": ["AdjustedGenre"]
      },
        {
        "joinaggregate": [{
            "op": "sum",
            "field": "GenreCount",
            "as": "TotalAnimes"
        }]
    },
    {
        "calculate": "datum.GenreCount / datum.TotalAnimes * 100",
        "as": "Percentage"
    }

],
    "height": {"step": 13},
    "encoding": {
      "y": {
        "field": "AdjustedGenre", 
        "type": "nominal", 
        "title": "Anime Genre",
        "sort": {
            "field": "Percentage",
            "order":"descending"
          }
      },
      "x": {
        "field": "Percentage",
        "type": "quantitative",
        "title": "Percentage of Total Animes (%)"
      },
      "tooltip":[
        {"field":"AdjustedGenre", "type": "nominal", "title": "Genre"},
        {"field": "GenreCount", "type": "quantitative", "title":"Number of Animes"},
        {"field": "Percentage", "type": "quantitative", "format":".2f", "title":"Percentage of Animes (%)"}
      ]
    }
  }